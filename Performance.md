- [Performance](#performance)
  - [æ€§èƒ½ä¼˜åŒ–](#%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96)
- [å·¥ç¨‹åŒ–](#%e5%b7%a5%e7%a8%8b%e5%8c%96)
    - [AST](#ast)
    - [Webpack](#webpack)
      - [Webpack HMR åŸç†](#webpack-hmr-%e5%8e%9f%e7%90%86)
      - [webpack ä¼˜åŒ–](#webpack-%e4%bc%98%e5%8c%96)

# Performance

ä¿æŒå‰ç«¯çš„å¯ç”¨æ€§ã€ç¨³å®šæ€§ï¼ˆåŠ è½½è¿‡æ…¢ï¼Œäº¤äº’å¡é¡¿å»¶è¿Ÿï¼‰ç­‰æ€§èƒ½é—®é¢˜

lighthouse webpageTest å·¥å…·åˆ†æå…·ä½“æŒ‡æ ‡

**window.performance.timing**
![performance timing](https://lz5z.com/assets/img/performance.png)

```

const t = window.performance.timing
const times = {
  // DNS æŸ¥è¯¢æ—¶é—´
  dns = t.domainLookUpEnd - t.domainLookUpStart,

  // TCPè¿æ¥è€—æ—¶
  tcp = t.connectEnd - t.connectStart,

  // Requestè¯·æ±‚è€—æ—¶
  request = t.requestEnd - t.requestStart,

  // è¯»å–é¡µé¢ç¬¬ä¸€ä¸ªå­—èŠ‚çš„æ—¶é—´
  ttfb: t.responseEnd - t.reqestStart,

  // è§£æDOMæ ‘ğŸŒ²çš„æ—¶é—´
  toDOMtree: t.domComplete - t.domInteractive,

  // ç™½å±æ—¶é—´
  blank: t.domLoading - t.navigationStart,

  // DOM Ready
  domReady: t.domContentLoadedEventEnd - t.navigationStart,

  // é¡µé¢åŠ è½½æ—¶é—´
  loadPage: t.loadEventEnd - t.navigationStart,

}

```

- DOMContentLoaded: æ˜¯æŒ‡é¡µé¢å…ƒç´ åŠ è½½å®Œæ¯•ï¼Œä½†æ˜¯ä¸€äº›èµ„æºæ¯”å¦‚å›¾ç‰‡è¿˜æ— æ³•çœ‹åˆ°ï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™é¡µé¢æ˜¯å¯ä»¥æ­£å¸¸äº¤äº’çš„ï¼Œæ¯”å¦‚æ»šåŠ¨ï¼Œè¾“å…¥å­—ç¬¦ç­‰ã€‚
- load æ˜¯æŒ‡é¡µé¢ä¸Šæ‰€æœ‰çš„èµ„æºï¼ˆå›¾ç‰‡ï¼ŒéŸ³é¢‘ï¼Œè§†é¢‘ç­‰ï¼‰åŠ è½½å®Œæˆã€‚

## æ€§èƒ½ä¼˜åŒ–

1. **é¡µé¢åŠ è½½é€Ÿåº¦**
2. **æ‰§è¡Œæ•ˆç‡**
3. **äº¤äº’æ•ˆæœ**

æ€§èƒ½æŒ‡æ ‡ï¼š

1. FCPï¼šFirst Contentful Paint é¦–æ¬¡å†…å®¹ç»˜åˆ¶
2. FMPï¼šFirst Meaningful Paint é¦–æ¬¡æœ‰æ•ˆç»˜åˆ¶
3. Speed Indexï¼š é€Ÿåº¦æŒ‡æ•°ï¼Œæµè§ˆå™¨å‡ºç°å¯æ˜¯å†…å®¹çš„æ—¶é—´
4. FIDï¼šFirst CPU Idle ä¸»çº¿ç¨‹åˆæ¬¡ç©ºé—²æ—¶é—´
5. TTIï¼šTime To Interactive å¯äº¤äº’æ—¶é—´
6. Max Potential First Input Delayï¼š æœ€å¤§æ— å“åº”æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯æœ€é•¿çš„ task æ‰§è¡Œæ—¶é—´ã€‚
7. Total Blocking Timeï¼š æ€»é˜»å¡æ—¶é—´
8. Largest Contentful Paintï¼š æœ€å¤§å†…å®¹æ¸²æŸ“

æ–¹æ³•ï¼š

1. ç”¨ç”¨ PRPL æ¨¡å¼ç«‹å³åŠ è½½
   1. P = Push æˆ–è€… Preload æœ€é‡è¦çš„èµ„æº
      `<link rel="preload" as="style" href="css/style.css">`
   2. R = Render å°½å¿«æ¸²æŸ“åˆå§‹è·¯ç”±
   3. P = Pre-Cache é¢„ç¼“å­˜å‰©ä¸‹çš„èµ„æº
   4. L = Lazy-load æ‡’åŠ è½½å…¶ä»–è·¯ç”±å’Œéå…³é”®èµ„æº
2. æ¶ˆé™¤é˜»å¡æ¸²æŸ“çš„èµ„æº
   1. é¢„åŠ è½½
      - preload é¢„åŠ è½½é«˜ä¼˜å…ˆçº§èµ„æºï¼Œä¸é˜»å¡å½“å‰é¡µé¢æ¸²æŸ“
      - prefetch é¢„è·å–ä½ä¼˜å…ˆçº§èµ„æºï¼Œä½œä¸ºç¼“å­˜ä½¿ç”¨
      - dns-prefetch é¢„æŸ¥è¯¢ DNS
      - preconnect é¢„å…ˆå»ºç«‹è¿æ¥
3. å›¾ç‰‡
   1. é«˜æ•ˆç¼–ç å›¾ç‰‡ï¼Œ Imagemin å‹ç¼©å›¾ç‰‡
   2. å»¶è¿ŸåŠ è½½å›¾ç‰‡ lazyload
   3. åˆé€‚å¤§å°çš„å›¾ç‰‡ï¼ˆå®½é«˜ï¼‰ï¼ŒåŠ è½½å“åº”å¼å›¾ç‰‡ï¼Œ`srcset`,`sizes`
   4. ä¸‹ä¸€ä»£å›¾ç‰‡æŠ€æœ¯ webp
   5. CDN
4. html
   1. æ·»åŠ  doctypeï¼Œé¿å…æ€ªå¼‚æ¨¡å¼ï¼ˆéæ ‡å‡†æ’ç‰ˆè¡Œä¸ºï¼‰
5. css
   1. æœ€å°åŒ–å’Œå‹ç¼© css
   2. å¯¼å‡ºå…³é”® css
      - `<header><style type='text/css'>.content{...}.btn{...}`
   3. å»¶åéå…³é”® css
      ```
      <header>
      <link rel='preload' as='style' href='styles.css' onload="this.onload=null;this.rel='stylesheet'">
      <noscript><link rel='stylesheet' href='styles.css'/></noscript>
      ```
      - preload å¼‚æ­¥åŠ è½½æ ·å¼è¡¨
      - onload åŠ è½½å®Œç«‹å³å¤„ç†æ ·å¼
      - =null é¿å…æœ‰äº›æµè§ˆå™¨å¤„ç†åˆ‡æ¢ rel çš„æ—¶å€™é‡æ–°è°ƒç”¨
      - noscript é¿å…ç¦æ­¢ä½¿ç”¨ script
   4. ç§»é™¤æ— ç”¨ css
   5. ä½¿ç”¨åª’ä½“æŸ¥è¯¢ä¼˜åŒ– css èƒŒæ™¯å›¾ç‰‡
6. js

   1. åŠ è½½å…³é”®èµ„æºæ¥æé«˜åŠ è½½é€Ÿåº¦
      - `<link rel="preload" as="script" href="critical.js">`
   2. ä»£ç åˆ†å‰²å‡å°‘ js è´Ÿè½½
      - webpack,rollup ç­‰åˆ†å‰²ä»£ç å—ï¼ŒåŠ¨æ€å¯¼å…¥ dynamic import
   3. æœ€å°åŒ–å’Œå‹ç¼© js
      - teser-webpack-plugin
      - gzip
   4. ç§»é™¤æ— ç”¨ä»£ç 
      - webpack-bundle-analyzer
   5. ä½¿ç”¨ç°ä»£ js `<script type="module">`
   6. å‡å°‘ js æ‰§è¡Œæ—¶é—´,é¿å… long task
   7. é¿å…ä½¿ç”¨ document.writeï¼ˆå»¶è¿Ÿé¡µé¢å†…å®¹å¸ƒå±€ï¼‰

7. å­—ä½“
   1. å¼€å¯å­—ä½“å‹ç¼©
   2. å½“åŠ è½½å­—ä½“èµ„æºçš„æ—¶å€™ä¿è¯å­—ä½“å¯è§
8. å‡å°‘ Server å“åº”æ—¶é—´ï¼ˆTTFBï¼‰
9. å¼€å¯ HTTPSï¼ŒHTTP/2

   ```
   server {
     listen 443 ssl http2 default_server;
     ssl_certificate    /path/to/server.cert;
     ssl_certificate_key /path/to/server.key;
     # ...}
   ```

10. é¿å…å¤šé¡µé¢é‡å®šå‘
11. ä½¿ç”¨ video æ ¼å¼ä»£æ›¿åŠ¨ç”»å†…å®¹
12. å‡å°‘ç¬¬ä¸‰æ–¹åº“ä»£ç çš„å½±å“

ç­–ç•¥ï¼š

1. é¿å…å·¨å¤§çš„ç½‘ç»œè¯·æ±‚è´Ÿè½½
2. è®¾ç½®é™æ€èµ„æºé«˜æ•ˆçš„ç¼“å­˜ç­–ç•¥
3. é¿å…è¿‡é‡çš„ DOM size
4. é¿å…é“¾å¼å…³é”®èµ„æºè¯·æ±‚
5. å‡å°‘ä¸»çº¿ç¨‹å·¥ä½œ
6. å‡å°‘è¯·æ±‚æ•°é‡ï¼Œå‡å°ä¼ è¾“æ•°æ®å¤§å°

å®‰å…¨é—®é¢˜ï¼š

1. å¯ç”¨ https
2. è¿æ¥å®‰å…¨çš„ cross-origin
   - æ·»åŠ `rel='noopener' rel='noreferer'` åˆ° link`target='_blank'`
3. åœæ­¢ä½¿ç”¨ç¬¬ä¸‰æ–¹ä¸å®‰å…¨çš„åº“
4. é˜»æ­¢å¤åˆ¶å¯†ç  `input.addEventListener('paste',(e)=>e.preventDefault())`
5. é¡µé¢åŠ è½½çš„æ—¶å€™è¯·æ±‚ geolocationã€notification æƒé™

# å·¥ç¨‹åŒ–

å‰ç«¯å·¥ç¨‹åŒ–å››å¤§ç‰¹æ€§ï¼š

1. æ¨¡å—åŒ– - ï¼ˆåœ¨æ–‡ä»¶å±‚é¢ä¸Šï¼Œå¯¹ä»£ç å’Œèµ„æºçš„æ‹†åˆ†ï¼‰
   - js æ¨¡å—åŒ–
   - css æ¨¡å—åŒ–
   - èµ„æºæ¨¡å—åŒ–
     - ä¾èµ–å…³ç³»å•ä¸€åŒ–
     - èµ„æºå¤„ç†é›†ä¸­åŒ–
     - é¡¹ç›®ç»“æ„æ¸…æ™°åŒ–
2. ç»„ä»¶åŒ–ï¼ˆå¼€å‘ï¼‰- ï¼ˆåœ¨è®¾è®¡å±‚é¢ä¸Šï¼Œå¯¹ UI çš„æ‹†åˆ†ï¼‰
3. è‡ªåŠ¨åŒ–
   1. æŒç»­é›†æˆ
   2. è‡ªåŠ¨åŒ–æ„å»º
   3. è‡ªåŠ¨åŒ–éƒ¨ç½²
   4. è‡ªåŠ¨åŒ–æµ‹è¯•
4. è§„èŒƒåŒ–
   1. ç›®å½•ç»“æ„çš„åˆ¶å®š
   2. ç¼–ç è§„èŒƒ
   3. å‰åç«¯æ¥å£è§„èŒƒ
   4. æ–‡æ¡£è§„èŒƒ
   5. ç»„ä»¶ç®¡ç†
   6. Git åˆ†æ”¯ç®¡ç†
   7. Commit æè¿°è§„èŒƒ
   8. CodeReview

### AST

> AST æ˜¯å¯¹æºä»£ç çš„æŠ½è±¡è¯­æ³•ç»“æ„çš„æ ‘çŠ¶è¡¨ç°å½¢å¼

1. è¯æ³•åˆ†æï¼ˆåˆ†è¯ï¼‰ï¼š input ---> (tokenizer) ---> tokens
   - å¯¹è¾“å…¥ä»£ç è¿›è¡Œåˆ†è¯ï¼Œæ ¹æ®æœ€å°æœ‰æ•ˆè¯­æ³•å•å…ƒï¼Œå¯¹å­—ç¬¦ä¸²è¿›è¡Œåˆ‡å‰²
   - è¯æ³•å•å…ƒï¼ˆtokenï¼‰ï¼šæ ‡è¯†ç¬¦ã€æ•°å­—ã€è¿ç®—ç¬¦ã€ç©ºæ ¼...
2. è¯­æ³•åˆ†æï¼štokens ---> (parser) ---> AST
   - å¯¹è¯æ³•å•å…ƒè¿›è¡Œä¸€ä¸ªæ•´ä½“çš„ç»„åˆï¼Œè¯†åˆ«è¯­å¥(statement)å’Œè¡¨è¾¾å¼(expression)
   - æ¶‰åŠè¯»å–ã€æš‚å­˜ã€å›æº¯ã€æš‚å­˜ç‚¹é”€æ¯ç­‰æ“ä½œ

**Babel:**

1. è§£æ parse
2. è½¬æ¢ transform
3. ç”Ÿæˆ generate

plugin:

- plugin ä¼šè¿è¡Œåœ¨ presets ä¹‹å‰
- plugin æŒ‰æ­£åºé¡ºåºæ‰§è¡Œ
- presets å€’åºæ‰§è¡Œ

### Webpack

**å…·ä½“æµç¨‹**

1. åˆå§‹åŒ–å‚æ•°ï¼šä»é…ç½®æ–‡ä»¶å’Œ Shell è¯­å¥æ±‡æ€»è¯»å–ä¸åˆå¹¶å‚æ•°ï¼Œå¾—å‡ºæœ€ç»ˆçš„å‚æ•°
2. å¼€å§‹ç¼–è¯‘ï¼šç”¨ä¸Šä¸€æ­¥å¾—åˆ°çš„å‚æ•°åˆå§‹åŒ– Compiler å¯¹è±¡ï¼ŒåŠ è½½æ‰€æœ‰é…ç½®çš„æ’ä»¶ï¼Œé€šè¿‡æ‰§è¡Œå¯¹è±¡çš„ run æ–¹æ³•å¼€å§‹æ‰§è¡Œç¼–è¯‘ã€‚
3. ç¡®å®šå…¥å£ï¼šæ ¹æ®é…ç½®æ–‡ä»¶çš„ entry æ‰¾å‡ºå·¦å³å…¥å£æ–‡ä»¶
4. ç¼–è¯‘æ¨¡å—ï¼šä»å…¥å£æ–‡ä»¶å‡ºå‘ï¼Œè°ƒç”¨æ‰€æœ‰é…ç½®çš„ Loader å¯¹æ¨¡å—è¿›è¡Œç¿»è¯‘ï¼Œå†æ‰¾å‡ºè¯¥æ¨¡å—ä¾èµ–çš„æ¨¡å—ï¼Œå†é€’å½’æœ¬æ­¥éª¤ç›´åˆ°æ‰€æœ‰å…¥å£ä¾èµ–çš„æ–‡ä»¶éƒ½ç»å†äº†æœ¬æ­¥éª¤çš„å¤„ç†ã€‚
5. å®Œæˆæ¨¡å—ç¼–è¯‘ï¼šåœ¨ç»è¿‡ç¬¬ 4 æ­¥ä½¿ç”¨ Loader ç¿»è¯‘å®Œæ‰€æœ‰æ¨¡å—åï¼Œå¾—åˆ°äº†æ¯ä¸ªæ¨¡å—è¢«ç¿»è¯‘åçš„æœ€ç»ˆå†…å®¹åŠå®ƒä»¬ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚
6. è¾“å‡ºèµ„æºï¼šæ ¹æ®å…¥å£å’Œæ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œç»„è£…æˆä¸€ä¸ªä¸ªåŒ…å«å¤šä¸ªæ¨¡å—çš„ Chunkï¼Œå†å°†æ¯ä¸ª Chunk è½¬æ¢æˆä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶åŠ å…¥è¾“å‡ºåˆ—è¡¨ä¸­ï¼Œè¿™æ˜¯å¯ä»¥ä¿®æ”¹è¾“å‡ºå†…å®¹çš„æœ€åæœºä¼šã€‚
7. è¾“å‡ºå®Œæˆï¼šå†ç¡®å®šå¥½è¾“å‡ºå†…å®¹åï¼Œæ ¹æ®é…ç½®æ–‡ä»¶ç¡®å®šè¾“å‡ºçš„è·¯å¾„å’Œæ–‡ä»¶åï¼Œå°†æ–‡ä»¶çš„å†…å®¹å†™å…¥æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚

åœ¨ä»¥ä¸Šè¿‡ç¨‹ä¸­ï¼ŒWebpack ä¼šåœ¨ç‰¹å®šçš„æ—¶é—´ç‚¹å¹¿æ’­ç‰¹å®šçš„äº‹ä»¶ï¼Œæ’ä»¶åœ¨ç›‘å¬åˆ°å¯¹åº”çš„äº‹ä»¶åæ‰§è¡Œç‰¹å®šçš„é€»è¾‘ï¼Œå¹¶ä¸”æ’ä»¶å¯ä»¥è°ƒç”¨ webpack æä¾›çš„ api æ”¹å˜ webpack çš„è¿è¡Œç»“æœã€‚

1. åˆå§‹åŒ–ï¼š å¯åŠ¨æ„å»ºï¼Œè¯»å–ä¸åˆå¹¶é…ç½®å‚æ•°ï¼ŒåŠ è½½ pluginï¼Œå®ä¾‹åŒ– Compiler
2. ç¼–è¯‘ï¼šä» Entry å‡ºå‘ï¼Œé’ˆå¯¹æ¯ä¸ª Module ä¸²è¡Œè°ƒç”¨å¯¹åº”çš„ Loader å»ç¿»è¯‘æ–‡ä»¶çš„å†…å®¹ï¼Œå†æ‰¾å‡º Module ä¾èµ–çš„ Moduleï¼Œé€’å½’åœ°è¿›è¡Œç¼–è¯‘å¤„ç†ã€‚
3. è¾“å‡ºï¼šåœ¨ç¼–è¯‘åçš„ Module ç»„åˆæˆ Chunkï¼Œå°† Chunk è½¬æ¢æˆæ–‡ä»¶ï¼Œè¾“å‡ºåˆ°æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚

**loader ğŸ†š plugin**
**loaderï¼š**

4. loader æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ˜¯ä¸€ä¸ªæ–‡ä»¶åŠ è½½å™¨ï¼Œèƒ½å¤ŸåŠ è½½æ–‡ä»¶èµ„æºï¼Œå¹¶è¿›è¡Œå¤„ç†
5. loader è½¬æ¢æŒ‡å®šç±»å‹çš„æ¨¡å—

**pluginï¼š**

3. åœ¨ webpack è¿è¡Œçš„ç”Ÿå‘½å‘¨æœŸä¸­ä¼šå¹¿æ’­å‡ºè®¸å¤šäº‹ä»¶ï¼ˆhooksï¼‰ï¼Œplugin å¯ä»¥ç›‘å¬è¿™äº›äº‹ä»¶ï¼Œåœ¨åˆé€‚çš„ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°é€šè¿‡ webpack æä¾›çš„ api è¿›è¡Œç»“æœçš„å¤„ç†
4. plugin æ˜¯ä¸€ä¸ªæ‰©å±•å™¨ï¼ŒåŸºäº webpack äº‹ä»¶æµæœºåˆ¶å·¥ä½œï¼Œä¸ç›´æ¥æ“ä½œæ–‡ä»¶ã€‚é’ˆå¯¹ loader ç»“æŸåï¼Œæ‰“åŒ…æ•´ä¸ªè¿‡ç¨‹ä¸­æ‰§è¡Œæ›´å¹¿æ³›çš„ä»»åŠ¡æ¯”å¦‚æ‰“åŒ…ä¼˜åŒ–ã€æ–‡ä»¶ç®¡ç†ã€ç¯å¢ƒæ³¨å…¥ç­‰ã€‚

#### Webpack HMR åŸç†

![hmr](https://pic1.zhimg.com/80/v2-f7139f8763b996ebfa28486e160f6378_1440w.jpg)

1. åœ¨ webpack çš„ watch æ¨¡å¼ä¸‹ï¼Œwebpack ç›‘å¬åˆ°æ–‡ä»¶å˜åŒ–ï¼Œæ ¹æ®é…ç½®æ–‡ä»¶å¯¹æ¨¡å—é‡æ–°ç¼–è¯‘æ‰“åŒ…ï¼Œå¹¶å°†æ‰“åŒ…åçš„ä»£ç ä»¥ JavaScript å¯¹è±¡çš„å½¢å¼ä¿å­˜åœ¨å†…å­˜ä¸­ã€‚
2. ä¸»è¦æ˜¯ webpack-dev-server ä¸­çš„ webpack-dev-middleware ä¸ webpack çš„æ¥å£äº¤äº’ï¼Œwebpack-dev-middleware è°ƒç”¨ webpack æš´éœ²çš„ api å¯¹ä»£ç å˜åŒ–è¿›è¡Œç›‘å¬ï¼Œå¹¶ä¸”å‘Šè¯‰ webpackï¼Œå°†ä»£ç æ‰“åŒ…åˆ°å†…å­˜ä¸­ã€‚
3. webpack-dev-server å¯¹é…ç½®æ–‡ä»¶çš„ä¸€ä¸ªç›‘å¬ï¼ˆå½“ devServer.watchContentBase ä¸º true çš„æ—¶å€™ï¼‰ï¼Œå˜åŒ–åä¼šé€šçŸ¥æµè§ˆå™¨ live reloadï¼Œä¹Ÿå°±æ˜¯æµè§ˆå™¨åˆ·æ–°ï¼Œå¹¶ä¸æ˜¯ HMRã€‚
4. åœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä½¿ç”¨ SockJS å»ºç«‹ websocket é•¿é“¾æ¥é€šä¿¡ï¼Œå°† webpack ç¼–è¯‘æ‰“åŒ…çš„å„ä¸ªé˜¶æ®µçš„çŠ¶æ€ä¿¡æ¯ï¼ˆæ–°æ¨¡å—çš„ hash å€¼ï¼‰å’Œç¬¬ä¸‰æ­¥ç›‘å¬é™æ€æ–‡ä»¶å˜åŒ–çš„ä¿¡æ¯ä¼ é€ç»™æµè§ˆå™¨ç«¯ã€‚
5. webpack-dev-server å¹¶ä¸èƒ½è¯·æ±‚æ›´æ–°çš„ä»£ç å’Œä¸ä¼šçƒ­æ¨¡å—æ›¿æ¢ï¼Œè€Œæ˜¯æŠŠå·¥ä½œäº¤å›äº† webpackï¼Œwebpack æ ¹æ® webpack-dev-server ä¼ é€’çš„ä¿¡æ¯å’Œ dev-server çš„é…ç½®å†³å®šæ˜¯åˆ·æ–°æµè§ˆå™¨è¿˜æ˜¯çƒ­æ›´æ–°æ¨¡å—ã€‚
6. HotModuleReplacement.Runtime çƒ­æ¨¡å—æ›´æ–°è¿è¡Œæ—¶æ ¹æ®ä¸Šä¸€æ­¥éª¤ä¼ é€’çš„æ–°æ¨¡å— hash å€¼ï¼Œé€šè¿‡ JsonpMainTemplate.Runtime è¿è¡Œæ—¶ä»¥ Ajax å½¢å¼å‘æœåŠ¡ç«¯è¯·æ±‚æ‰€æœ‰è¦æ›´æ–°çš„æ¨¡å—çš„ hash åˆ—è¡¨ï¼Œç„¶åé€šè¿‡ jsonp å½¢å¼è¯·æ±‚æ‰€æœ‰çš„æ¨¡å—ä»£ç ã€‚
7. HotModulePlugin å¯¹æ–°æ—§æ¨¡å—è¿›è¡Œå¯¹æ¯”ï¼Œå†³å®šæ˜¯å¦æ›´æ–°æ¨¡å—ï¼Œæ›´æ–°ä¹‹å‰ï¼Œä¼šæ£€æŸ¥ä¾èµ–å…³ç³»å¹¶ä¸”æ›´æ–°æ¨¡å—é—´çš„ä¾èµ–å¼•ç”¨ã€‚
8. å½“ HMR å¤±è´¥ï¼Œå°†å›é€€åˆ° live reload é˜¶æ®µåˆ·æ–°æµè§ˆå™¨è·å–æœ€æ–°æ‰“åŒ…ä»£ç ã€‚

#### webpack ä¼˜åŒ–

**æ€»ç»“ï¼š**

1. åˆ†ææ‰“åŒ…é€Ÿåº¦
   - `webpack-bundle-analyzer`, `speed-measure-webpack-plugin`
2. ä¼˜åŒ–å¼€å‘ä½“éªŒ
   1. ä¼˜åŒ–æ„å»ºé€Ÿåº¦
      - å¼€å¯å¤šè¿›ç¨‹æ‰“åŒ… thread-loaderï¼Œhappypack
      - åˆç†åˆ©ç”¨ç¼“å­˜ cache-loaderï¼ŒHardSourceWebpackPlugin
      - ä¼˜åŒ–å‹ç¼©æ—¶é—´ terserï¼Œterser å¤šè¿›ç¨‹ï¼ŒParallelUglifyPlugin
      - dll åŠ¨æ€åº“æ–‡ä»¶
      - ç¼©å°æ–‡ä»¶æœç´¢èŒƒå›´
        - ä¼˜åŒ– loader é…ç½®
        - ä¼˜åŒ– resolve.moduleï¼Œä¼˜åŒ– resolve.mainFiledsã€resolve.aliasã€resolve.extensionsã€resolve.noParse
   2. ä¼˜åŒ–ä½¿ç”¨ä½“éªŒ
      - æ–‡ä»¶åˆ·æ–°ï¼Œè‡ªåŠ¨åˆ·æ–°ï¼ŒHMR
3. ä¼˜åŒ–è¾“å‡ºè´¨é‡
   1. å‡å°‘åŠ è½½æ—¶é—´
   2. æå‡ä»£ç æ€§èƒ½

å…·ä½“ï¼š

1. ä¼˜åŒ–å¼€å‘ä½“éªŒ
   1. ä¼˜åŒ–æ„å»ºé€Ÿåº¦
      - ç¼©å°æ–‡ä»¶çš„æœç´¢èŒƒå›´
        1. ä¼˜åŒ– Loader é…ç½®
           - `test: /\.js$/`ä¼˜åŒ–æ­£åˆ™è¡¨è¾¾å¼æ€§èƒ½
           - `use:['babel-loader?cacheDirectory']`å¼€å¯è½¬æ¢ç»“æœçš„ç¼“å­˜ / `cache-loader`
           - `include: path.resolve(__dirname, 'src')`åªé’ˆå¯¹ src ç›®å½•ä¸‹æ–‡ä»¶
        2. ä¼˜åŒ– resolve.modules é…ç½®
           ```
           resolve: {
             // ä½¿ç”¨ç»å¯¹è·¯å¾„æŒ‡æ˜ç¬¬ä¸‰æ–¹æ¨¡å—å­˜æ”¾ä½ç½®
             // å‡å°‘æœç´¢æ­¥éª¤
             modules: [path.resolve(__dirname, 'node_modules')]
           }
           ```
        3. ä¼˜åŒ– resolve.mainFields é…ç½®
           ```
           resolve: {
             // æ˜ç¡®æŒ‡æ˜ç¬¬ä¸‰æ–¹æ¨¡å—çš„å…¥å£æ–‡ä»¶æè¿°å­—æ®µï¼Œä»¥å‡å°‘æœç´¢æ­¥éª¤
             mainFields: ['main']
           }
           ```
        4. ä¼˜åŒ– resolve.alias é…ç½®
           ```
           resolve: {
             alias: {
               // ä½¿ç”¨aliaså°†å¯¼å…¥reactçš„è¯­å¥æ¢æˆç›´æ¥ä½¿ç”¨å•ç‹¬ã€å®Œæ•´çš„react.min.jsæ–‡ä»¶
               // å‡å°‘è€—æ—¶çš„é€’å½’è§£ææ“ä½œ
               // é€‚ç”¨äºæ•´ä½“æ€§æ¯”è¾ƒå¼ºçš„åº“
               // ä¸é€‚åˆtree-shaking
               'react': path.resolve(__dirname, './node_modules/react/dist/react.min.js')
             }
           }
           ```
        5. ä¼˜åŒ– resolve.extensions é…ç½®
           ```
           extensions: ['js', 'json']
           // å°½å¯èƒ½å‡å°‘åç¼€å°è¯•çš„å¯èƒ½æ€§
           ```
        6. ä¼˜åŒ– module.noParse é…ç½®
           ```
           module: {
             // å•ç‹¬å®Œæ•´çš„react.min.jsæ–‡ä»¶æ²¡æœ‰é‡‡ç”¨æ¨¡å—åŒ–ï¼Œå¿½ç•¥å¯¹è¿™ä¸ªæ–‡ä»¶çš„é€’å½’è§£æå¤„ç†
             noParse: [/react\.min\.js$]
           }
           ```
      - ä½¿ç”¨ DLLPlugin
        æ‰“åŒ…å¤ç”¨åŠ¨æ€é“¾æ¥åº“
        DLLPluginï¼šç”¨äºé«˜æ‰“åŒ…å‡ºä¸€ä¸ªä¸ªå•ç‹¬çš„åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶
        DLLReferencePluginï¼šç”¨äºåœ¨ä¸»è¦çš„é…ç½®æ–‡ä»¶ä¸­å¼•å…¥ DLLPlugin æ’ä»¶æ‰“åŒ…å¥½çš„åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶
        1. æ„å»ºåŠ¨æ€é“¾æ¥åº“æ–‡ä»¶
        ```
        // webpack.dll.config.js
        const DllPlugin = require('webpack/lib/DllPlugin')
        module.exports = {
         entry:{
           // reactç›¸å…³çš„æ¨¡å—æ”¾ç½®åœ¨ä¸€ä¸ªå•ç‹¬çš„åŠ¨æ€é“¾æ¥åº“ä¸­
           react: ['react','react-dom'],
           // polyfillå•ç‹¬æ”¾ç½®åœ¨ä¸€ä¸ªåŠ¨æ€é“¾æ¥åº“ä¸­
           polyfill: ['core-js/fn/object/assign', 'core-js/fn/promise', 'whatwg-fetch']
         },
         output: {
           filename: '[name].dll.js',
           path: path.resolve(__dirname, 'dist'),
           library: '_dll_[name] // é˜²æ­¢å…¨å±€å˜é‡å†²çª
         },
         plugins: [
           new DllPlugin({
             name: '_dll_[name]',
             path: path.join(__dirname, 'dist', '[name].manifest.json')
           })
         ]
        }
        ```
        1. ä½¿ç”¨åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶
        ```
        // webpack.config.js
        const DllReferencePlugin = require('webpack/lib/DllReferencePlugin')
        ...
        plugins: [
          new DllReferencePlugin({
            manifest: require('./dist/react.manifest.json')
          }),
          new DllReferencePlugin({
            manifest: require('./dist/polyfill.manifest.json')
          }),
        ]
        ```
        1. æ‰§è¡Œæ„å»º
           1. å¦‚æœåŠ¨æ€é“¾æ¥åº“ç›¸å…³çš„æ–‡ä»¶è¿˜æ²¡æœ‰ç¼–è¯‘å‡ºæ¥ï¼Œå°±éœ€è¦å…ˆå°†å®ƒä»¬ç¼–è¯‘å‡ºæ¥ã€‚ `webpack --config webpack.dll.config.js`
           2. åœ¨ç¡®ä¿åŠ¨æ€é“¾æ¥åº“å­˜åœ¨æ—¶ï¼Œæ‰èƒ½æ­£å¸¸ç¼–è¯‘å…¥å£æ‰§è¡Œæ–‡ä»¶ã€‚
      - ä½¿ç”¨ HappyPack / thread-loader
        æ¥å…¥ï¼š
        ```
        const happyThreadPool = Happypack.ThreadPool({size: 5})
        // æ„å»ºå…±äº«è¿›ç¨‹æ± ï¼Œåœ¨è¿›ç¨‹æ± ä¸­åŒ…å«5ä¸ªå­è¿›ç¨‹
        module: {
          rules:[
            {
              test: /.js$/,
              use: ['happypack/loader?id=babel']
            },
            {
              test: /.css$/,
              use: ExtractTextPlugin.extract({
                use: ['happypack/loader?id=css']
              })
            }
          ]
        },
        plugins: [
          new HappyPack({
            id: 'babel',
            loaders: ['babel-loader?cacheDirectory'],
            // ä½¿ç”¨å…±äº«è¿›ç¨‹æ± ä¸­çš„å­è¿›ç¨‹å»å¤„ç†ä»»åŠ¡
            threadPool: happyThreadPool,
          }),
          new HappyPack({
            id: 'css',
            loaders: ['css-loader'],
            // ä½¿ç”¨å…±äº«è¿›ç¨‹æ± ä¸­çš„å­è¿›ç¨‹å»å¤„ç†ä»»åŠ¡
            threadPool: happyThreadPool,
          })
        ]
        ```
        åŸç†ï¼šHappyPack å°†è¿™éƒ¨åˆ†è€—æ—¶çš„ loader å¤„ç†ä»»åŠ¡åˆ†è§£æˆå¤šä¸ªå­è¿›ç¨‹å»å¹¶è¡Œå¤„ç†ï¼Œä»è€Œå‡å°‘æ€»çš„æ„å»ºæ—¶é—´ã€‚
      - ä½¿ç”¨ ParallelUglifyPlugin
        å¼€å¯å¤šä¸ªå­è¿›ç¨‹ï¼Œå°†å¯¹å¤šä¸ªæ–‡ä»¶çš„å‹ç¼©å·¥ä½œåˆ†é…ç»™å¤šä¸ªå­è¿›ç¨‹å®Œæˆã€‚
        ```
        const ParallelUglifyPlugin = require('webpack-parallel-uglify-plugin')
        ...
        plugins: [
          new ParallelUglifyPlugin({
            uglifyJS: {
              output: {
                beautify: false,//ç´§å‡‘è¾“å‡º
                comments: false,//åˆ é™¤æ³¨é‡Š
              },
              compress: {
                warnings: false,//åˆ é™¤æ²¡æœ‰ç”¨åˆ°çš„ä»£ç æ—¶ä¸è¾“å‡ºè­¦å‘Š
                drop_console: true,//åˆ é™¤console
                collapse_vars: true,//å†…åµŒå·²å®šä¹‰ä½†åªç”¨åˆ°ä¸€æ¬¡çš„å˜é‡
                reduce_vars: true//æå–å‡ºç°å¤šæ¬¡ä½†æœªè¢«å®šä¹‰å˜é‡çš„å¼•ç”¨é™æ€å€¼
              }
            }
          })
        ]
        ```
   2. ä¼˜åŒ–ä½¿ç”¨ä½“éªŒ
      1. ä½¿ç”¨è‡ªåŠ¨åˆ·æ–°
         - æ–‡ä»¶ç›‘å¬
           ```
           module.export = {
             watch: true,
             watchOptions: {
               ignored: /node_modules/, //ä¸ç›‘å¬çš„æ–‡ä»¶
               aggregateTimeout: 300,//æˆªæµï¼Œæ–‡ä»¶å˜åŒ–300msåå†å»æ‰§è¡Œ
               poll: 1000 // é»˜è®¤ç¾å¦™è¯¢é—®1000æ¬¡
             }
           }
           ```
         - è‡ªåŠ¨åˆ·æ–°æµè§ˆå™¨
           `webpack-dev-server --inline false`
         - å¼€å¯çƒ­æ¨¡å—æ›´æ–°
           `devServer.hot: true`
2. ä¼˜åŒ–è¾“å‡ºè´¨é‡
   1. å‡å°‘ç”¨æˆ·èƒ½æ„ŸçŸ¥åˆ°çš„åŠ è½½æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯é¦–å±åŠ è½½æ—¶é—´
      - åŒºåˆ†ç¯å¢ƒ
      - å‹ç¼©ä»£ç 
      - CDN åŠ é€Ÿ
      - Tree Shaking
      - æå–å…¬å…±ä»£ç 
      - ä»£ç åˆ†å‰²æŒ‰éœ€åŠ è½½
   2. æå‡æµç•…åº¦ï¼Œä¹Ÿå°±æ˜¯æå‡ä»£ç æ€§èƒ½
      - ä½¿ç”¨ Prepack
        åœ¨ä¿æŒè¿è¡Œç»“æœä¸€è‡´çš„æƒ…å†µä¸‹ï¼Œæ”¹å˜æºä»£ç çš„è¿è¡Œé€»è¾‘ï¼Œè¾“å‡ºæ€§èƒ½æ›´å¥½çš„ js ä»£ç ã€‚å®é™…ä¸Š prepack æ˜¯ä¸€ä¸ªéƒ¨åˆ†æ±‚å€¼å™¨ï¼Œç¼–è¯‘ä»£ç æ—¶æå‰å°†è®¡ç®—ç»“æœæ”¾åˆ°ç¼–è¯‘åçš„ä»£ç ä¸­ï¼Œè€Œä¸æ˜¯åœ¨ä»£ç è¿è¡Œæ—¶é‡‡å–æ±‚å€¼ã€‚
      - ä½¿ç”¨ Scope Hoisting
        ä½œç”¨åŸŸæå‡ï¼Œè®© webpack æ‰“åŒ…å‡ºæ¥çš„ä»£ç æ–‡ä»¶æ›´å°ï¼Œè¿è¡Œæ›´å¿«ï¼Œ`plugins:[new ModuleConcatenationPlugin()]`
3. è¾“å‡ºåˆ†æï¼Œåˆ†æé—®é¢˜æ‰€åœ¨
   1. `webpack --profile`è®°å½•æ„å»ºè¿‡ç¨‹ä¸­çš„è€—æ—¶ä¿¡æ¯
   2. `webpack --json`ä»¥ json çš„æ ¼å¼è¾“å‡ºæ„å»ºç»“æœã€‚
   3. `webpack-bundle-analyzer`
   4. `speed-measure-webpack-plugin`
